{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"./services/chat/chat.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = [\"popup\"];\n\nfunction AppComponent_div_0_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_div_4_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const user_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.selectUserHandler(user_r5 == null ? null : user_r5.phone);\n    });\n    i0.ɵɵelement(1, \"img\", 11);\n    i0.ɵɵelementStart(2, \"p\", 12);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const user_r5 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", (user_r5 == null ? null : user_r5.phone) === (ctx_r3.selectedUser == null ? null : ctx_r3.selectedUser.phone) && \"active\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", user_r5 == null ? null : user_r5.image, i0.ɵɵsanitizeUrl)(\"alt\", user_r5 == null ? null : user_r5.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r5 == null ? null : user_r5.name);\n  }\n}\n\nfunction AppComponent_div_0_ng_container_7_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵelementStart(1, \"p\", 23);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r9 = ctx.$implicit;\n    const ctx_r8 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngClass\", (item_r9 == null ? null : item_r9.user) === (ctx_r8.currentUser == null ? null : ctx_r8.currentUser.name) && \"same-user\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r9 == null ? null : item_r9.message);\n  }\n}\n\nfunction AppComponent_div_0_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 13);\n    i0.ɵɵelement(2, \"img\", 11);\n    i0.ɵɵelementStart(3, \"p\", 12);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 14);\n    i0.ɵɵtemplate(6, AppComponent_div_0_ng_container_7_div_6_Template, 3, 2, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 16);\n    i0.ɵɵelementStart(8, \"div\", 3);\n    i0.ɵɵelementStart(9, \"div\", 17);\n    i0.ɵɵelementStart(10, \"div\", 18);\n    i0.ɵɵelementStart(11, \"input\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function AppComponent_div_0_ng_container_7_Template_input_ngModelChange_11_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return ctx_r10.messageText = $event;\n    })(\"keyup\", function AppComponent_div_0_ng_container_7_Template_input_keyup_11_listener($event) {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return $event.keyCode === 13 && ctx_r12.sendMessage();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 20);\n    i0.ɵɵelementStart(13, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function AppComponent_div_0_ng_container_7_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return ctx_r13.sendMessage();\n    });\n    i0.ɵɵtext(14, \"Send \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", ctx_r4.selectedUser == null ? null : ctx_r4.selectedUser.image, i0.ɵɵsanitizeUrl)(\"alt\", ctx_r4.selectedUser == null ? null : ctx_r4.selectedUser.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r4.selectedUser == null ? null : ctx_r4.selectedUser.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.messageArray);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.messageText);\n  }\n}\n\nfunction AppComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"div\", 4);\n    i0.ɵɵelementStart(3, \"div\", 5);\n    i0.ɵɵtemplate(4, AppComponent_div_0_div_4_Template, 4, 4, \"div\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 7);\n    i0.ɵɵelementStart(6, \"div\", 8);\n    i0.ɵɵtemplate(7, AppComponent_div_0_ng_container_7_Template, 15, 5, \"ng-container\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.userList);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.selectedUser);\n  }\n}\n\nfunction AppComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵelementStart(1, \"h4\", 25);\n    i0.ɵɵtext(2, \"Login\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 26);\n    i0.ɵɵelementStart(4, \"div\", 3);\n    i0.ɵɵelementStart(5, \"div\", 27);\n    i0.ɵɵelementStart(6, \"div\", 28);\n    i0.ɵɵelementStart(7, \"input\", 29);\n    i0.ɵɵlistener(\"ngModelChange\", function AppComponent_ng_template_1_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.phone = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 30);\n    i0.ɵɵelementStart(9, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_1_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const d_r14 = restoredCtx.dismiss;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.login(d_r14);\n    });\n    i0.ɵɵtext(10, \"Login\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.phone);\n  }\n}\n\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(modalService, chatService) {\n      this.modalService = modalService;\n      this.chatService = chatService;\n      this.messageArray = [];\n      this.storageArray = [];\n      this.showScreen = false;\n      this.userList = [{\n        id: 1,\n        name: 'Teste 1',\n        phone: '9876598765',\n        image: 'assets/user/user-1.png',\n        roomId: {\n          2: 'room-1',\n          3: 'room-2',\n          4: 'room-3'\n        }\n      }, {\n        id: 2,\n        name: 'Teste 2',\n        phone: '9876543210',\n        image: 'assets/user/user-2.png',\n        roomId: {\n          1: 'room-1',\n          3: 'room-4',\n          4: 'room-5'\n        }\n      }, {\n        id: 3,\n        name: 'Teste 3',\n        phone: '9988776655',\n        image: 'assets/user/user-3.png',\n        roomId: {\n          1: 'room-2',\n          2: 'room-4',\n          4: 'room-6'\n        }\n      }, {\n        id: 4,\n        name: 'Teste 4',\n        phone: '9876556789',\n        image: 'assets/user/user-4.png',\n        roomId: {\n          1: 'room-3',\n          2: 'room-5',\n          3: 'room-6'\n        }\n      }];\n    }\n\n    ngOnInit() {\n      this.chatService.getMessage().subscribe(data => {\n        // this.messageArray.push(data);\n        if (this.roomId) {\n          setTimeout(() => {\n            this.storageArray = this.chatService.getStorage();\n            const storeIndex = this.storageArray.findIndex(storage => storage.roomId === this.roomId);\n            this.messageArray = this.storageArray[storeIndex].chats;\n          }, 500);\n        }\n      });\n    }\n\n    ngAfterViewInit() {\n      this.openPopup(this.popup);\n    }\n\n    openPopup(content) {\n      this.modalService.open(content, {\n        backdrop: 'static',\n        centered: true\n      });\n    }\n\n    login(dismiss) {\n      this.currentUser = this.userList.find(user => user.phone === this.phone.toString());\n      this.userList = this.userList.filter(user => user.phone !== this.phone.toString());\n\n      if (this.currentUser) {\n        this.showScreen = true;\n        dismiss();\n      }\n    }\n\n    selectUserHandler(phone) {\n      this.selectedUser = this.userList.find(user => user.phone === phone);\n      this.roomId = this.selectedUser.roomId[this.currentUser.id];\n      this.messageArray = [];\n      this.storageArray = this.chatService.getStorage();\n      const storeIndex = this.storageArray.findIndex(storage => storage.roomId === this.roomId);\n\n      if (storeIndex > -1) {\n        this.messageArray = this.storageArray[storeIndex].chats;\n      }\n\n      this.join(this.currentUser.name, this.roomId);\n    }\n\n    join(username, roomId) {\n      this.chatService.joinRoom({\n        user: username,\n        room: roomId\n      });\n    }\n\n    sendMessage() {\n      this.chatService.sendMessage({\n        user: this.currentUser.name,\n        room: this.roomId,\n        message: this.messageText\n      });\n      this.storageArray = this.chatService.getStorage();\n      const storeIndex = this.storageArray.findIndex(storage => storage.roomId === this.roomId);\n\n      if (storeIndex > -1) {\n        this.storageArray[storeIndex].chats.push({\n          user: this.currentUser.name,\n          message: this.messageText\n        });\n      } else {\n        const updateStorage = {\n          roomId: this.roomId,\n          chats: [{\n            user: this.currentUser.name,\n            message: this.messageText\n          }]\n        };\n        this.storageArray.push(updateStorage);\n      }\n\n      this.chatService.setStorage(this.storageArray);\n      this.messageText = '';\n    }\n\n  }\n\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.ChatService));\n  };\n\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"app-root\"]],\n    viewQuery: function AppComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.popup = _t.first);\n      }\n    },\n    decls: 3,\n    vars: 1,\n    consts: [[\"class\", \"container-fluid\", 4, \"ngIf\"], [\"popup\", \"\"], [1, \"container-fluid\"], [1, \"row\"], [1, \"col-md-4\"], [1, \"user-list-card\"], [\"class\", \"user-card\", 3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-md-8\"], [1, \"chat-container\"], [4, \"ngIf\"], [1, \"user-card\", 3, \"ngClass\", \"click\"], [1, \"avatar\", 3, \"src\", \"alt\"], [1, \"username\"], [1, \"chat-header\"], [1, \"chat-body\"], [3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"chat-footer\"], [1, \"col-md-10\"], [1, \"form-group\", \"mb-0\"], [\"type\", \"text\", \"placeholder\", \"Type a message\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"keyup\"], [1, \"col-md-2\", \"text-center\", \"align-self-center\"], [1, \"btn\", \"btn-primary\", \"btn-sm\", \"px-3\", 3, \"click\"], [3, \"ngClass\"], [1, \"message-container\"], [1, \"modal-header\"], [1, \"modal-title\"], [1, \"modal-body\"], [1, \"col-md-12\"], [1, \"form-group\"], [\"type\", \"number\", \"placeholder\", \"Enter your phone number\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"modal-footer\"], [1, \"btn\", \"btn-sm\", \"btn-primary\", 3, \"click\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AppComponent_div_0_Template, 8, 2, \"div\", 0);\n        i0.ɵɵtemplate(1, AppComponent_ng_template_1_Template, 11, 1, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.showScreen);\n      }\n    },\n    directives: [i3.NgIf, i3.NgForOf, i3.NgClass, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i4.NumberValueAccessor],\n    styles: [\"\"]\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}